<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Banking App - Prototype Pattern</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    *{box-sizing:border-box;}
    body{font-family:'Roboto',sans-serif;background:#f5f5f5;margin:0;padding:0;}
    header{background:#004080;color:#fff;padding:15px;text-align:center;font-size:26px;font-weight:bold;}
    nav{background:#333;padding:10px;text-align:center;}
    nav button{margin:0 8px;padding:8px 14px;color:#fff;background:#004080;border:none;border-radius:5px;cursor:pointer;font-weight:bold;}
    nav button:hover{background:#003366;}
    .page{display:none;padding:20px;}
    .card{background:#fff;padding:25px;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,0.1);max-width:600px;margin:20px auto;}
    input{width:95%;padding:10px;margin:10px 0;border-radius:6px;border:1px solid #ddd;font-size:16px;}
    button.action{background:#004080;color:#fff;border:none;padding:10px 16px;border-radius:6px;cursor:pointer;font-size:16px;margin-top:8px;}
    button.action:hover{background:#003366;}
    .account-list{display:flex;flex-wrap:wrap;justify-content:center;gap:20px;margin-top:20px;}
    .account-item{background:#fff;border-radius:12px;padding:15px;width:220px;box-shadow:0 3px 8px rgba(0,0,0,0.08);text-align:center;transition:transform 0.2s;}
    .account-item:hover{transform:translateY(-5px);box-shadow:0 6px 15px rgba(0,0,0,0.15);}
    .account-item h3{margin:10px 0 6px;font-size:20px;color:#004080;}
    .account-item p{font-size:16px;margin-bottom:10px;}
    .transaction-item{border-bottom:1px solid #eee;padding:12px 0;font-size:16px;display:flex;justify-content:space-between;}
    .transaction-total{margin-top:15px;font-weight:bold;font-size:18px;text-align:right;}
    .transaction-buttons{display:flex;gap:10px;justify-content:flex-end;margin-top:15px;}
    .transaction-buttons button{flex:1;}
    @media(max-width:600px){.account-list{flex-direction:column;align-items:center;}}
  </style>
</head>
<body>

<header>Banking Application</header>

<nav>
  <button onclick="showPage('registerPage')">Register</button>
  <button onclick="showPage('accountsPage')">Accounts</button>
  <button onclick="showPage('transactionPage')">Transactions</button>
</nav>

<!-- Register Page -->
<div id="registerPage" class="page">
  <div class="card">
    <h2>Register User</h2>
    <form onsubmit="registerUser(event)">
      <input type="text" id="username" placeholder="Enter username" required><br>
      <input type="password" id="password" placeholder="Enter password" required><br>
      <button type="submit" class="action">Register</button>
    </form>
    <p style="margin-top:10px;"><b>Default Account:</b> Username = <i>admin</i>, Password = <i>1234</i></p>
  </div>
</div>

<!-- Accounts Page -->
<div id="accountsPage" class="page">
  <div class="card">
    <h2>Your Bank Accounts</h2>
    <div class="account-list" id="accountList"></div>
  </div>
</div>

<!-- Transactions Page -->
<div id="transactionPage" class="page">
  <div class="card">
    <h2>Transaction History</h2>
    <div id="transactionList"></div>
    <div class="transaction-buttons">
      <button class="action" onclick="repeatLastTransaction()">Repeat Last Transaction</button>
    </div>
  </div>
</div>

<script>
  // -------- Prototype Pattern Classes --------
  class BankAccount {
    constructor(name,balance){ this.name=name; this.balance=balance; this.id="acc-"+Date.now(); }
    clone(){ return new BankAccount(this.name,this.balance); }
    deposit(amount){ this.balance+=amount; return amount; }
    withdraw(amount){ if(amount<=this.balance){ this.balance-=amount; return amount; } return 0; }
  }

  class Transaction {
    constructor(account, type, amount){
      this.account=account; this.type=type; this.amount=amount; this.id="tx-"+Date.now();
    }
    clone(){ return new Transaction(this.account, this.type, this.amount); }
  }

  // -------- State --------
  let accounts = JSON.parse(localStorage.getItem("accounts")) || [];
  let transactions = JSON.parse(localStorage.getItem("transactions")) || [];
  let lastTransaction = transactions.length>0 ? transactions[transactions.length-1] : null;
  let users = JSON.parse(localStorage.getItem("users")) || [{username:"admin", password:"1234"}];
  let currentUser = null;

  // -------- Page Switch --------
  function showPage(pageId){
    document.querySelectorAll(".page").forEach(p=>p.style.display="none");
    document.getElementById(pageId).style.display="block";
    if(pageId==="accountsPage") renderAccounts();
    if(pageId==="transactionPage") renderTransactions();
  }

  // -------- User Registration --------
  function registerUser(e){
    e.preventDefault();
    const uname=document.getElementById("username").value;
    const pwd=document.getElementById("password").value;
    users.push({username:uname, password:pwd});
    localStorage.setItem("users", JSON.stringify(users));
    currentUser = uname;
    if(accounts.length===0){ // create default account for user
      let acc = new BankAccount("Savings",1000);
      accounts.push(acc);
      localStorage.setItem("accounts",JSON.stringify(accounts));
    }
    alert("User registered successfully! Logged in as "+uname);
    showPage('accountsPage');
  }

  // -------- Accounts Rendering --------
  function renderAccounts(){
    const accDiv=document.getElementById("accountList");
    accDiv.innerHTML="";
    if(accounts.length===0){ accDiv.innerHTML="<p>No accounts yet.</p>"; return; }
    accounts.forEach(acc=>{
      let div=document.createElement("div");
      div.className="account-item";
      div.innerHTML=`<h3>${acc.name}</h3>
                     <p>Balance: ₹${acc.balance}</p>
                     <input type="number" id="dep-${acc.id}" placeholder="Deposit amount">
                     <button class="action" onclick='deposit("${acc.id}")'>Deposit</button>
                     <input type="number" id="with-${acc.id}" placeholder="Withdraw amount">
                     <button class="action" onclick='withdraw("${acc.id}")'>Withdraw</button>`;
      accDiv.appendChild(div);
    });
  }

  function deposit(accId){
    let acc = accounts.find(a=>a.id===accId);
    let amt = parseFloat(document.getElementById("dep-"+accId).value);
    if(isNaN(amt) || amt<=0){ alert("Enter valid amount"); return; }
    acc.deposit(amt);
    localStorage.setItem("accounts",JSON.stringify(accounts));
    let tx = new Transaction(acc.name,"Deposit",amt);
    transactions.push(tx);
    lastTransaction = tx;
    localStorage.setItem("transactions",JSON.stringify(transactions));
    renderAccounts();
    alert(`Deposited ₹${amt} to ${acc.name}`);
  }

  function withdraw(accId){
    let acc = accounts.find(a=>a.id===accId);
    let amt = parseFloat(document.getElementById("with-"+accId).value);
    if(isNaN(amt) || amt<=0){ alert("Enter valid amount"); return; }
    if(acc.withdraw(amt)===0){ alert("Insufficient balance"); return; }
    localStorage.setItem("accounts",JSON.stringify(accounts));
    let tx = new Transaction(acc.name,"Withdraw",amt);
    transactions.push(tx);
    lastTransaction = tx;
    localStorage.setItem("transactions",JSON.stringify(transactions));
    renderAccounts();
    alert(`Withdrew ₹${amt} from ${acc.name}`);
  }

  // -------- Transactions Rendering --------
  function renderTransactions(){
    const txDiv=document.getElementById("transactionList");
    txDiv.innerHTML="";
    if(transactions.length===0){ txDiv.innerHTML="<p>No transactions yet.</p>"; return; }
    transactions.slice().reverse().forEach(tx=>{
      let div = document.createElement("div");
      div.className="transaction-item";
      div.textContent=`[${tx.type}] ${tx.account} - ₹${tx.amount}`;
      txDiv.appendChild(div);
    });
  }

  function repeatLastTransaction(){
    if(!lastTransaction){ alert("No last transaction!"); return; }
    let acc = accounts.find(a=>a.name===lastTransaction.account);
    if(lastTransaction.type==="Deposit"){ acc.deposit(lastTransaction.amount); }
    else if(lastTransaction.type==="Withdraw"){
      if(acc.withdraw(lastTransaction.amount)===0){ alert("Insufficient balance"); return; }
    }
    let tx = lastTransaction.clone();
    tx.id="tx-"+Date.now();
    transactions.push(tx);
    lastTransaction = tx;
    localStorage.setItem("accounts",JSON.stringify(accounts));
    localStorage.setItem("transactions",JSON.stringify(transactions));
    renderAccounts(); renderTransactions();
    alert(`Repeated last transaction: ${tx.type} ₹${tx.amount} on ${tx.account}`);
  }

  // Start on Register Page
  showPage('registerPage');
</script>

</body>
</html>
