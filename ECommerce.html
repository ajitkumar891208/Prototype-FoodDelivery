<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>E-Commerce Platform - Prototype Pattern</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }
    body { font-family: 'Roboto', sans-serif; background:#f5f5f5; margin:0; padding:0; }
    header { background:#0073e6; color:#fff; padding:15px; text-align:center; font-size:26px; font-weight:bold; }
    nav { background:#333; padding:10px; text-align:center; }
    nav button { margin:0 8px; padding:8px 14px; color:#fff; background:#0073e6; border:none; border-radius:5px; cursor:pointer; font-weight:bold; }
    nav button:hover { background:#005bb5; }
    .page { display:none; padding:20px; }
    .card { background:#fff; padding:25px; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.1); max-width:600px; margin:20px auto; }
    input, select { width:95%; padding:10px; margin:10px 0; border-radius:6px; border:1px solid #ddd; font-size:16px; }
    button.action { background:#0073e6; color:#fff; border:none; padding:10px 16px; border-radius:6px; cursor:pointer; font-size:16px; }
    button.action:hover { background:#005bb5; }
    .product-list { display:flex; flex-wrap:wrap; justify-content:center; gap:20px; margin-top:20px; }
    .product-item { background:#fff; border-radius:12px; padding:15px; width:200px; box-shadow:0 3px 8px rgba(0,0,0,0.08); text-align:center; transition: transform 0.2s; }
    .product-item:hover { transform: translateY(-5px); box-shadow:0 6px 15px rgba(0,0,0,0.15); }
    .product-item img { width:100%; height:120px; object-fit:contain; border-radius:6px; }
    .product-item h3 { margin:10px 0 6px; font-size:18px; color:#0073e6; }
    .product-item p { font-size:16px; margin-bottom:10px; }
    .cart-item { border-bottom:1px solid #eee; padding:12px 0; font-size:16px; display:flex; justify-content:space-between; }
    .cart-total { margin-top:15px; font-weight:bold; font-size:18px; text-align:right; }
    .cart-buttons { display:flex; gap:10px; justify-content:flex-end; margin-top:15px; }
    .cart-buttons button { flex:1; }
    @media(max-width:600px){ .product-list{flex-direction:column; align-items:center;} }
  </style>
</head>
<body>

<header>E-Commerce Platform</header>

<nav>
  <button onclick="showPage('registerPage')">Register</button>
  <button onclick="showPage('catalogPage')">Products</button>
  <button onclick="showPage('cartPage')">Cart</button>
</nav>

<!-- Register Page -->
<div id="registerPage" class="page">
  <div class="card">
    <h2>Register User</h2>
    <form onsubmit="registerUser(event)">
      <input type="text" id="username" placeholder="Enter username" required><br>
      <input type="password" id="password" placeholder="Enter password" required><br>
      <button type="submit" class="action">Register</button>
    </form>
    <p style="margin-top:10px;"><b>Default Account:</b> Username = <i>admin</i>, Password = <i>1234</i></p>
  </div>
</div>

<!-- Product Catalog Page -->
<div id="catalogPage" class="page">
  <div class="card">
    <h2>Products</h2>
    <div class="product-list" id="productList"></div>
  </div>
</div>

<!-- Cart Page -->
<div id="cartPage" class="page">
  <div class="card">
    <h2>Your Cart</h2>
    <div id="cartList"></div>
    <div class="cart-total" id="cartTotal"></div>
    <div class="cart-buttons">
      <button class="action" onclick="placeOrder()">Place Order</button>
      <button class="action" onclick="repeatLastOrder()">Repeat Last Order</button>
    </div>
  </div>
</div>

<script>
  // -------- Prototype Pattern Classes --------
  class Product {
    constructor(name, price, img){ this.name=name; this.price=price; this.img=img; }
    clone(){ return new Product(this.name, this.price, this.img); }
  }

  class Order {
    constructor(customer, items){
      this.customer = customer;
      this.items = items.map(i=>i.clone());
      this.id = "ord-" + Date.now();
    }
    clone(){ return new Order(this.customer, this.items); }
  }

  // -------- State --------
  const productPrototype = new Product("Sample", 100, "https://via.placeholder.com/150");
  const products = [
    (()=>{let p=productPrototype.clone(); p.name="Laptop"; p.price=50000; p.img="https://via.placeholder.com/150/0073e6/ffffff?text=Laptop"; return p;})(),
    (()=>{let p=productPrototype.clone(); p.name="Smartphone"; p.price=20000; p.img="https://via.placeholder.com/150/0073e6/ffffff?text=Phone"; return p;})(),
    (()=>{let p=productPrototype.clone(); p.name="Headphones"; p.price=2000; p.img="https://via.placeholder.com/150/0073e6/ffffff?text=Headphones"; return p;})(),
    (()=>{let p=productPrototype.clone(); p.name="Watch"; p.price=5000; p.img="https://via.placeholder.com/150/0073e6/ffffff?text=Watch"; return p;})()
  ];

  let cart = JSON.parse(localStorage.getItem("cart")) || [];
  let lastOrder = JSON.parse(localStorage.getItem("lastOrder")) || null;
  let users = JSON.parse(localStorage.getItem("users")) || [{username:"admin", password:"1234"}];
  let currentUser = null;

  // -------- Page Switch --------
  function showPage(pageId){
    document.querySelectorAll(".page").forEach(p => p.style.display="none");
    document.getElementById(pageId).style.display="block";
    if(pageId==="catalogPage") renderCatalog();
    if(pageId==="cartPage") renderCart();
  }

  // -------- User Registration --------
  function registerUser(e){
    e.preventDefault();
    const uname=document.getElementById("username").value;
    const pwd=document.getElementById("password").value;
    users.push({username:uname, password:pwd});
    localStorage.setItem("users", JSON.stringify(users));
    currentUser = uname;
    alert("User registered successfully! Logged in as "+uname);
    showPage('catalogPage');
  }

  // -------- Catalog Rendering --------
  function renderCatalog(){
    const productListDiv = document.getElementById("productList");
    productListDiv.innerHTML = "";
    products.forEach(p=>{
      let div=document.createElement("div");
      div.className="product-item";
      div.innerHTML = `<img src="${p.img}" alt="${p.name}"><h3>${p.name}</h3><p>₹${p.price}</p>
        <button class="action" onclick='addToCart("${p.name}", ${p.price}, "${p.img}")'>Add to Cart</button>`;
      productListDiv.appendChild(div);
    });
  }

  function addToCart(name, price, img){
    let item = products.find(p=>p.name===name).clone();
    cart.push(item);
    localStorage.setItem("cart", JSON.stringify(cart));
    alert(name + " added to cart!");
  }

  // -------- Cart Rendering --------
  function renderCart(){
    const cartDiv = document.getElementById("cartList");
    const cartTotalDiv = document.getElementById("cartTotal");
    cartDiv.innerHTML = "";
    if(cart.length===0){
      cartDiv.innerHTML="<p>Your cart is empty!</p>"; 
      cartTotalDiv.innerHTML="";
      return;
    }
    let total = 0;
    cart.forEach(item=>{
      total += item.price;
      let div = document.createElement("div");
      div.className="cart-item";
      div.textContent=`${item.name} - ₹${item.price}`;
      cartDiv.appendChild(div);
    });
    cartTotalDiv.innerHTML = `Total: ₹${total}`;
  }

  // -------- Place Order --------
  function placeOrder(){
    if(cart.length===0){ alert("Cart is empty!"); return; }
    let order = new Order(currentUser||"Guest", cart);
    lastOrder = order;
    localStorage.setItem("lastOrder", JSON.stringify(lastOrder));
    cart = [];
    localStorage.removeItem("cart");
    renderCart();
    alert("Order placed successfully! Order ID: "+order.id);
  }

  // -------- Repeat Last Order --------
  function repeatLastOrder(){
    if(!lastOrder){ alert("No last order to repeat!"); return; }
    let newOrder = new Order(lastOrder.customer, lastOrder.items);
    lastOrder = newOrder;
    localStorage.setItem("lastOrder", JSON.stringify(lastOrder));
    alert("Repeated last order! Order ID: "+newOrder.id);
  }

